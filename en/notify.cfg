[gcode_macro _NOTIFY]
gcode:
    {% set msg = params.MSG|default("Ok")|string %}
    {% set type = params.TYPE|default("ok")|string %}

    {% set type_on = printer.save_variables.variables.notify_{type}|default(1) | int %}

    {% if type_on == 1 %}
        {action_call_remote_method("notify",
                             name="notifier",
                             message=msg)}
    {% endif %}

[gcode_shell_command update_notify]
command: /opt/config/mod_data/plugins/notify/update_notify.sh
timeout: 7200
verbose: False

[delayed_gcode _UPDATE_NOTIFY]
initial_duration: 3
gcode:
    RUN_SHELL_COMMAND CMD=update_notify PARAMS=0

[gcode_macro UPDATE_NOTIFY]
gcode:
    RUN_SHELL_COMMAND CMD=update_notify PARAMS=1
    REBOOT
